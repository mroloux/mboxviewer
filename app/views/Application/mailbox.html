<!DOCTYPE html>
<html>
    <head>
    	<title>mbox</title>
    	<meta charset="${_response_encoding}">
		<style type="text/css">
			#{include '/public/stylesheets/bootstrap.min.css'/}
		</style>
		<style type="text/css">
			.modal { width: 940px; margin-left: -470px; }
			pre { border: none; background-color: transparent; }
		</style>
    </head>
    <body> 
    	<div class="container">
			<table class="table">
				<thead>
					<tr>
						<th>Date</th>
						<th>Subject</th>
						<th>From</th>
					</tr>
				</thead>
				<tbody>
					#{list items:mailbox.emails, as:'email'}
						<tr class="mail">
							<td style="width: 60px;">${email.date ? email.date.format('yy-MM-dd') : ''}</td>
							<td>${email.subject}</td>
							<td style="width: 150px;">#{addresses email.from /}</td>
						</tr>
					#{/list}
				</tbody>
			</table>
			
			<div id="fullEmails">
				#{list items:mailbox.emails, as:'email'}
					<div class="modal hide fullEmail">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">Ã—</button>
							<h3>${email.subject}</h3>
						</div>
						<div class="modal-body">
							<div>
								<span class="label">From</span>#{fullAddresses email.from /}
							</div>
							#{if email.to && !email.to.empty}
								<div>
									<span class="label">To</span>#{fullAddresses email.to /}
								</div>
							#{/if}
							#{if email.cc && !email.cc.empty}
							<div>
								<span class="label">BCC</span>#{fullAddresses email.cc /}
							</div>
							#{/if}
							#{if email.bcc && !email.bcc.empty}
							<div>
								<span class="label">CC</span>#{fullAddresses email.bcc /}
							</div>
							#{/if}
						
							#{set attachments: email.attachments /}
							#{if !attachments.empty}
								<div><span class="label">${attachments.size()} attachments</span> 
								#{list attachments, as:'attachment'}
									<b>${attachment.fileName}</b> (${attachment.fileSizeBytes.formatSize()}) 
								#{/list}
							#{/if}
							
							<div style="margin-top: 20px;">
								${email.bodyAsString().raw()}
							</div>
						</div>
					</div>
				#{/list}
			</div>
		</div>
		
    	<script type="text/javascript">#{include '/public/javascripts/jquery.1.7.2.min.js'/}</script>
    	<script type="text/javascript">#{include '/public/javascripts/bootstrap.js'/}</script>
    	<script type="text/javascript">
    	$(function() {
    		$('.mail').click(function() {
    			var clickedEmailIndex = $(this).index();
    			var fullEmailDiv = $('.fullEmail').eq(clickedEmailIndex);
    			$(fullEmailDiv).modal();
    		});
    	});
    	</script>
	</body>
</html>